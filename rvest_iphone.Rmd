---
title: "rvest_iphone"
author: "andrea"
date: "2020/3/27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

原本想試用 `rtweet` 搭配 `quanteda` 的日文斷詞功能整理 [twitter 上的武漢肺炎日文資料](https://andreashih.github.io/blog/journal/rtweet-quanteda.html)，但遲遲無法解決在 RStudio 上可以執行但不能輸出成 `.md` 檔的問題，因此先暫緩，回去複習一下 `rvest` 。剛好搭上 2020 新 iPhone 的潮流，決定來爬看看 Mobile01 上 iPhone 版的資料。 
偶然發現一個好用的 [Chrome 外掛](https://selectorgadget.com/)


### 1. 先把資料爬下來

```{r}
#http://r3dmaotech.blogspot.com/2016/05/r-rvest.html  
links <- paste0("https://www.mobile01.com/topiclist.php?f=383&p=", 1:30)
data <- c()
for(i in 1:length(links)){
  url <- links[i]
  content <- read_html(url) %>% html_nodes(".u-ellipsis") %>% html_text()
  temp <- iconv(content,'utf8')
  data <- c(data, temp)
  ##sleep time
  Sys.sleep(runif(1, 2, 4))
}
title <- data[seq(1, length(data), by = 3)]
post_id <- data[seq(2, length(data), by = 3)]
reply_id <- data[seq(3, length(data), by = 3)]
head(title)
```

### 2. `jiebaR` 斷詞

```{r}
library(jiebaR)

# Data: 3 篇文章
#docs <- title3

# Initialize jiebaR
seg <- worker()

docs_segged <- rep("", 3)
for (i in seq_along(title)) {
  # Segment each element in docs
  segged <- segment(title[i], seg)

  # Collapse the character vector into a string, separated by space
  docs_segged[i] <- paste0(segged, collapse = " ")
}

head(docs_segged)
```

### 3. 用斷好詞的 title 建立 dataframe

```{r}
docs_df <- tibble::tibble(
  doc_id = seq_along(docs_segged),
  content = docs_segged
)

knitr::kable(docs_df, align = "c")
docs_df
```

### 將 docs_df 轉成 tidytext format

```{r}
library(tidytext)

tidy_text_format <- docs_df %>%
  unnest_tokens(output = "word", input = "content",
                token = "regex", pattern = " ")
tidy_text_format
```

### 4. 詞頻表

```{r}
# Equivalent to ...
tidy_text_format %>%
  count(word) %>%
  arrange(desc(n))
```
